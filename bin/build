#!/usr/bin/env ruby

require 'fileutils'
require 'zlib'

SPLITTER = /\s*,\s*/

raise 'lang and platform not provided' unless ARGV[0] && ARGV[1] && ARGV[2]

name = ARGV[0]
@langs = [''] + ARGV[1].split(SPLITTER)
@platforms = ['common'] + ARGV[2].split(SPLITTER)
@build_path = "tmp.build/#{name}/man1/"


FileUtils.mkdir_p(File.join(@build_path, 'man1'))

def add_folder path, out = nil
  out ||= File.join(@build_path, 'man1')
  if File.exist?(path)
    FileUtils.cp(Dir[File.join(path,'*.gz')], out) 
  end
end

def add_langs lang
  lang_path = "tmp.man/pages.#{lang}/"
  if File.exist?(lang_path)
    add_folder
  end
end

@platforms.each do |plf|
  add_folder "tmp.man/pages/#{plf}/" 
end

@langs.each do |lang|
  lang = '.'+lang if lang!=''
  
  @platforms.each do |plf|
    add_folder "tmp.man/pages#{lang}/#{plf}/" 
  end
end


%x|zip -r #{name}.zip #{@build_path}|







