#!/usr/bin/env ruby

require 'fileutils'
require 'zlib'

SPLITTER = /\s*,\s*/

raise 'lang and platform not provided' unless ARGV[0] && ARGV[1] && ARGV[2]

name = ARGV[0]
@langs = ARGV[1].split(SPLITTER)
@platforms = ['common'] + ARGV[2].split(SPLITTER)
@build_path = "tmp.build/#{name}/"


FileUtils.mkdir_p(File.join(@build_path, 'man1'))

def add_folder path, out = nil
  # puts pathg
  # puts out
  if File.exist?(path)
    out ||= File.join(@build_path, 'man1')
    FileUtils.mkdir_p(out)
    FileUtils.cp(Dir[File.join(path,'*.gz')], out) 
  end
end

def add_langs lang
  lang_path = "tmp.man/pages.#{lang}/"
  puts lang_path
  puts File.exist?(lang_path)
  if File.exist?(lang_path)
    @platforms.each do |plf|
      add_folder File.join(lang_path, plf), File.join(@build_path, lang, 'man1')
    end
  end
end

@platforms.each do |plf|
  add_folder "tmp.man/pages/#{plf}/" 
end

@langs.each do |lang|
  add_langs(lang)
end

%x|zip -r #{name}.zip #{@build_path}|







